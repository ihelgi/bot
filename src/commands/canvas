const { createCanvas, registerFont } = require('canvas');
const { AttachmentBuilder } = require('discord.js');

registerFont('./src/fonts/Inter.ttc', { family: 'Inter' });

async function generateTextImage(text) {
    const width = 500;
    const height = 100;
    const canvas = createCanvas(width, height);
    const ctx = canvas.getContext('2d');

    // Sfondo grigio scuro
    ctx.fillStyle = '#303030';
    ctx.fillRect(0, 0, width, height);

    // Stile del testo
    ctx.fillStyle = '#FFFFFF'; // Testo bianco
    ctx.font = '50px Inter'; // Cambia il font se necessario
    ctx.fillText(text, 20, 50); // Disegna il testo

    // Convertire in buffer immagine
    const buffer = canvas.toBuffer();
    return new AttachmentBuilder(buffer, { name: 'text.png' });
}

async function handleCanvasCommand(message) {
    const text = message.content.slice(0, -2).trim(); // Rimuove gli ultimi due caratteri "()" dal messaggio
    if (!text) {
        return message.reply('Il messaggio Ã¨ vuoto! Scrivi qualcosa prima di `()`.');
    }

    const image = await generateTextImage(text);
    await message.channel.send({ files: [image] });
}

module.exports = { handleCanvasCommand };